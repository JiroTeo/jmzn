(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-linlin-personal-news-consult"],{2728:function(t,a,e){"use strict";e.r(a);var n=e("3343"),i=e("59d7");for(var s in i)"default"!==s&&function(t){e.d(a,t,function(){return i[t]})}(s);e("9cf9");var o=e("2877"),r=Object(o["a"])(i["default"],n["a"],n["b"],!1,null,"66cc3fa6",null);a["default"]=r.exports},3343:function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-uni-view",[e("v-uni-view",{staticClass:"common-head"},[e("v-uni-image",{staticClass:"arrow-back",attrs:{src:"../../../../static/icon_arrow.png"},on:{click:function(a){a=t.$handleEvent(a),t.returnClick(a)}}}),e("v-uni-view",{staticClass:"common-title"},[t._v("我的消息")])],1),e("v-uni-view",{staticClass:"newsNav"},[e("v-uni-navigator",{staticClass:"active",attrs:{url:"consult"}},[t._v("咨询信息")]),e("v-uni-navigator",{attrs:{url:"zan"}},[t._v("评论和赞")]),e("v-uni-navigator",{attrs:{url:"inform"}},[t._v("推送消息")])],1),e("v-uni-view",{staticClass:"consultList"},[t._l(t.messageList,function(a,n){return e("v-uni-view",{key:n,staticClass:"row list clearfix",attrs:{id:"height","data-username":a.username,"data-nickname":a.nickName},on:{click:function(a){a=t.$handleEvent(a),t.resetUnreadCount(a)}}},[e("v-uni-image",{staticClass:"tx",attrs:{src:a.avatar}}),e("v-uni-view",{staticClass:"desc"},[e("v-uni-text",[t._v(t._s(a.nickName))]),e("v-uni-text",[t._v(t._s(a.extras?a.extras.lastConversation:""))])],1),e("v-uni-view",{staticClass:"time clearfix"},[e("v-uni-text",[t._v(t._s(a.mtime))]),a.unread_msg_count>0?e("v-uni-text",{staticClass:"dot"}):t._e()],1)],1)}),0==t.messageList.length?e("v-uni-view",{staticClass:"empty"},[e("v-uni-image",{staticClass:"image",attrs:{src:t.imgUrl+"/empty_fans.png"}}),e("v-uni-view",{staticClass:"describe"},[t._v("还没有人联系您哦~")])],1):t._e()],2)],1)},i=[];e.d(a,"a",function(){return n}),e.d(a,"b",function(){return i})},"59d7":function(t,a,e){"use strict";e.r(a);var n=e("6c92"),i=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(a,t,function(){return n[t]})}(s);a["default"]=i.a},"65c4":function(t,a,e){a=t.exports=e("2350")(!1),a.push([t.i,".newsNav[data-v-66cc3fa6]{width:100%;height:%?88?%;background:#fff;margin-bottom:%?22?%;text-align:center}.newsNav uni-navigator[data-v-66cc3fa6]{display:inline-block;height:%?84?%;line-height:%?84?%;font-size:%?28?%;color:#919499;border-bottom:%?4?% solid #fff;margin:0 7%}.newsNav uni-navigator.active[data-v-66cc3fa6]{color:#141414;border-bottom:%?4?% solid #579efa;font-weight:700}.consultList .row[data-v-66cc3fa6]{padding:0 4%;height:%?150?%;background:#fff;margin-bottom:%?1?%;position:relative}.consultList .row .tx[data-v-66cc3fa6]{float:left;width:%?96?%;height:%?96?%;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;margin:%?28?% %?30?% 0 0}.consultList .row .desc[data-v-66cc3fa6]{float:left;width:%?400?%;height:%?150?%}.consultList .row .desc uni-text[data-v-66cc3fa6]:first-child{display:block;font-size:%?28?%;height:%?30?%;line-height:%?30?%;overflow:hidden;color:#1a1a1a;margin:%?42?% 0 %?15?% 0}.consultList .row .desc uni-text[data-v-66cc3fa6]:nth-child(2){display:block;font-size:%?24?%;color:#919499;height:%?30?%;line-height:%?30?%;overflow:hidden}.consultList .row .time[data-v-66cc3fa6]{float:right;text-align:right;font-size:%?24?%;color:#aaadb3;padding-top:%?40?%}.consultList .row .time uni-text[data-v-66cc3fa6]{display:block}.consultList .row .time .dot[data-v-66cc3fa6]{float:right;width:%?16?%;height:%?16?%;background:#ef3233;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;margin-top:%?25?%}",""])},"6c92":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=getApp(),i=(e("ef31"),{data:function(){return{messageList:[""],isLoad:!0}},onLoad:function(){var t=this;n.initIM().then(function(){n.loginIM().then(function(){n.globalData.JIM.onSyncConversation(function(t){t.forEach(function(t,a){var e=t.msgs.splice(-1);n.globalData.JIM.updateConversation({username:t.from_username,extras:e[0].content.msg_body.extras})})}),t.getMessageList(),t.openMsgReceive()})})},onShow:function(){var t=this;this.isLoad?this.isLoad=!1:n.initIM().then(function(){n.loginIM().then(function(){t.getMessageList(),t.openMsgReceive()})})},onUnload:function(){n.globalData.JIM.loginOut()},onHide:function(){n.globalData.JIM.loginOut()},methods:{returnClick:function(){uni.navigateTo({url:"news"})},getData:function(){uni.showLoading({title:"加载中..."})},openMsgReceive:function(){var t=this;n.globalData.JIM.onMsgReceive(function(a){var e=!0;t.messageList.forEach(function(i,s){a.messages.forEach(function(a){i.username==a.from_username&&(e=!1,i.extras=a.content.msg_body.extras,n.globalData.JIM.updateConversation({username:i.username,extras:i.extras}),i.unread_msg_count++,t.messageList[s]=i)}),e&&t.getMessageList()})})},resetUnreadCount:function(t){var a=t.currentTarget.dataset,e=a.username,i=a.nickname,s=this.messageList,o=this;s.forEach(function(t,a){t.username==e&&(o.messageList[a].unread_msg_count=0)}),n.globalData.JIM.resetUnreadCount({username:e}),uni.navigateTo({url:"/pages/productList/productDetail/IM?username="+e+"&nickname="+i})},getMessageList:function(){var t=this;n.globalData.JIM.getConversation().onSuccess(function(a){var e=a.code,n=a.conversations,i=a.message;if(0==e){if(console.log(n),0==n.length)return;n.forEach(function(a,e){(new Date).getDate()==new Date(a.mtime).getDate()?a.mtime=new Date(a.mtime).Format("hh:mm"):a.mtime=new Date(a.mtime).Format("yyyy-MM-dd"),t.messageList=n})}else uni.showToast({title:i,icon:"none"})}).onFail(function(t){})}}});a.default=i},"9cf9":function(t,a,e){"use strict";var n=e("a1f5"),i=e.n(n);i.a},a1f5:function(t,a,e){var n=e("65c4");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=e("4f06").default;i("6b6c2e56",n,!0,{sourceMap:!1,shadowMode:!1})}}]);