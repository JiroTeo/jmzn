(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-messageList-messageList"],{"4fdf":function(n,e,t){"use strict";t.r(e);var a=t("63ff"),i=t.n(a);for(var o in a)"default"!==o&&function(n){t.d(e,n,function(){return a[n]})}(o);e["default"]=i.a},"63ff":function(n,e,t){"use strict";function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=getApp(),o=(t("ef31"),{data:function(){return{messageList:[""],isLoad:!0}},onLoad:function(n){var e=this;console.log("开始加载聊天消息"),i.initIM().then(function(){i.loginIM().then(function(){i.JIM.onSyncConversation(function(n){n.forEach(function(n,e){var t=n.msgs.splice(-1);i.JIM.updateConversation({username:n.from_username,extras:t[0].content.msg_body.extras})})}),e.getMessageList(),e.openMsgReceive()})})},onShow:function(){},onUnload:function(){this.globalData.JIM.loginOut()},onHide:function(){this.globalData.JIM.loginOut()},methods:{getData:function(){uni.showLoading({title:"加载中..."})},openMsgReceive:function(){var n=this;i.globalDataJIM.onMsgReceive(function(e){var t=!0;n.data.messageList.forEach(function(i,o){e.messages.forEach(function(e){i.username==e.from_username&&(t=!1,i.extras=e.content.msg_body.extras,n.JIM.updateConversation({username:i.username,extras:i.extras}),i.unread_msg_count++,n.setData(a({},"messageList["+o+"]",i)))}),t&&n.getMessageList()})})},resetUnreadCount:function(n){var e=n.currentTarget.dataset,t=e.username,o=e.nickname,s=this.data.messageList,r=this;s.forEach(function(n,e){n.username==t&&r.setData(a({},"messageList["+e+"].unread_msg_count",0))}),i.JIM.resetUnreadCount({username:t}),uni.navigateTo({url:"../IM/IM?username="+t+"&nickname="+o})},getMessageList:function(){var n=this;i.JIM.getConversation().onSuccess(function(e){var t=e.code,a=e.conversations,o=e.message;if(0==t){if(console.log(a),0==a.length)return;a.forEach(function(e,t){(new Date).getDate()==new Date(e.mtime).getDate()?e.mtime=new Date(e.mtime).Format("hh:mm"):e.mtime=new Date(e.mtime).Format("yyyy-MM-dd"),i.globalData.JIM.getResource({media_id:e.avatar}).onSuccess(function(i){var o=i.code,s=i.url,r=i.massage;o?uni.showToast({title:r,icon:"none"}):(e.avatar=s,a.length==t+1&&n.setData({messageList:a}))}).onFail(function(n){n.code;var e=n.massage;uni.showToast({title:e,icon:"none"})})})}else uni.showToast({title:o,icon:"none"})}).onFail(function(n){})}}});e.default=o},"7d38":function(n,e,t){"use strict";t.r(e);var a=t("e435"),i=t("4fdf");for(var o in i)"default"!==o&&function(n){t.d(e,n,function(){return i[n]})}(o);t("fa47");var s=t("2877"),r=Object(s["a"])(i["default"],a["a"],a["b"],!1,null,"a3634d6e",null);e["default"]=r.exports},"95e3":function(n,e,t){var a=t("cceb");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var i=t("4f06").default;i("bc90062a",a,!0,{sourceMap:!1,shadowMode:!1})},cceb:function(n,e,t){e=n.exports=t("2350")(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 父级 */uni-page-body[data-v-a3634d6e]{background-color:#f5f5f5}.bg_blue[data-v-a3634d6e]{background-color:#42abb7}.bg_red[data-v-a3634d6e]{background-color:#c04b4c}\n/* 系统通知 */.box[data-v-a3634d6e]{margin-bottom:%?23?%;background-color:#fff}.box .row[data-v-a3634d6e]{min-height:%?152?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;padding:0 %?23?%;border-bottom:%?1?% solid #ebebeb;-webkit-box-sizing:border-box;box-sizing:border-box;color:#666}.box .row[data-v-a3634d6e]:last-child{border:0}.box .row .rowLeft[data-v-a3634d6e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.box .row .rowLeft .image[data-v-a3634d6e]{height:%?96?%;width:%?96?%;text-align:center;line-height:%?96?%;color:#fff;border-radius:50%}.box .row .rowLeft .image .iconfont[data-v-a3634d6e]{font-size:%?55?%}.box .row .rowLeft .name[data-v-a3634d6e]{margin-left:%?31?%;line-height:%?96?%}.box .row .rowRight[data-v-a3634d6e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;color:#999;font-size:%?24?%}.box .row .rowRight .number[data-v-a3634d6e]{height:%?34?%;color:#fff;line-height:%?34?%;font-size:%?20?%;text-align:center;padding:0 %?11?%;background-color:#c04b4c;border-radius:%?17?%}.icon-youjiantou[data-v-a3634d6e]{font-size:%?40?%;color:#ccc}\n/* 外层视图 */.messageList[data-v-a3634d6e]{width:100%}.list[data-v-a3634d6e]{position:relative;height:%?152?%;line-height:%?152?%;overflow:hidden;border-bottom:%?1?% solid #ebebeb}\n/* 删除外层包裹视图 */.list_del[data-v-a3634d6e]{position:absolute;top:0}.list_del.txt[data-v-a3634d6e]{position:relative;background-color:#fff;width:100%;z-index:5;padding:0 %?10?%;-webkit-transition:left .2s ease-in-out;-o-transition:left .2s ease-in-out;transition:left .2s ease-in-out;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}\n/* 删除 */.list_del.del[data-v-a3634d6e]{background-color:#e64340;width:%?180?%;text-align:center;z-index:4;right:0;color:#fff}\n/* 列表图片 */.list_img[data-v-a3634d6e]{width:%?105?%;height:%?105?%;border-radius:50%;vertical-align:middle;margin-left:%?15?%;margin-top:%?-8?%;display:inline-block}.list_del uni-text[data-v-a3634d6e]{white-space:nowarp;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;max-width:%?420?%}\n/* 列表名称 */.list_name[data-v-a3634d6e]{position:absolute;left:%?168?%;bottom:%?36?%}\n/* 活动时间 */.list_datas[data-v-a3634d6e]{position:absolute;left:%?168?%;top:%?36?%;font-size:13px;color:#818181}\n/* 未读数量 */.list_number[data-v-a3634d6e]{position:absolute;bottom:12px;right:25px;min-width:%?34?%;height:%?34?%;font-size:%?20?%;color:#fff;line-height:%?34?%;text-align:center;border-radius:50%;background-color:red}.list_time[data-v-a3634d6e]{position:absolute;top:12px;right:25px;min-width:%?34?%;height:%?34?%;color:#999;font-size:%?24?%;line-height:%?34?%;text-align:center;background-color:#fff}body.?%PAGE?%[data-v-a3634d6e]{background-color:#f5f5f5}",""])},e435:function(n,e,t){"use strict";var a=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",{staticClass:"messageList"},[0==n.messageList.length?t("v-uni-view",{staticClass:"empty"},[t("v-uni-image",{staticClass:"image",attrs:{src:n.imgUrl+"/empty_fans.png"}}),t("v-uni-view",{staticClass:"describe"},[n._v("还没有人联系您哦~")])],1):n._e(),n._l(n.messageList,function(e,a){return t("v-uni-view",{key:a,staticClass:"list",attrs:{id:"height"}},[t("v-uni-view",{attrs:{"data-username":e.username,"data-nickname":e.nickName},on:{click:function(e){e=n.$handleEvent(e),n.resetUnreadCount(e)}}},[t("v-uni-view",{staticClass:"list_del txt"},[t("v-uni-image",{staticClass:"list_img",attrs:{src:e.avatar}}),e.unread_msg_count>0?t("v-uni-view",{staticClass:"list_number"},[n._v(n._s(e.unread_msg_count))]):n._e(),t("v-uni-text",{staticClass:"list_time"},[n._v(n._s(e.mtime))]),t("v-uni-text",{staticClass:"list_name"},[n._v(n._s(e.nickName))]),t("v-uni-text",{staticClass:"list_datas"},[n._v(n._s(e.extras.lastConversation))])],1)],1)],1)})],2)},i=[];t.d(e,"a",function(){return a}),t.d(e,"b",function(){return i})},fa47:function(n,e,t){"use strict";var a=t("95e3"),i=t.n(a);i.a}}]);