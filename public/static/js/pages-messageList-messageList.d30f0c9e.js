(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-messageList-messageList"],{1173:function(n,t,e){t=n.exports=e("2350")(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 父级 */uni-page-body[data-v-85d0dbd4]{background-color:#f5f5f5}.bg_blue[data-v-85d0dbd4]{background-color:#42abb7}.bg_red[data-v-85d0dbd4]{background-color:#c04b4c}\n/* 系统通知 */.box[data-v-85d0dbd4]{margin-bottom:%?23?%;background-color:#fff}.box .row[data-v-85d0dbd4]{min-height:%?152?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;padding:0 %?23?%;border-bottom:%?1?% solid #ebebeb;-webkit-box-sizing:border-box;box-sizing:border-box;color:#666}.box .row[data-v-85d0dbd4]:last-child{border:0}.box .row .rowLeft[data-v-85d0dbd4]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.box .row .rowLeft .image[data-v-85d0dbd4]{height:%?96?%;width:%?96?%;text-align:center;line-height:%?96?%;color:#fff;border-radius:50%}.box .row .rowLeft .image .iconfont[data-v-85d0dbd4]{font-size:%?55?%}.box .row .rowLeft .name[data-v-85d0dbd4]{margin-left:%?31?%;line-height:%?96?%}.box .row .rowRight[data-v-85d0dbd4]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;color:#999;font-size:%?24?%}.box .row .rowRight .number[data-v-85d0dbd4]{height:%?34?%;color:#fff;line-height:%?34?%;font-size:%?20?%;text-align:center;padding:0 %?11?%;background-color:#c04b4c;border-radius:%?17?%}.icon-youjiantou[data-v-85d0dbd4]{font-size:%?40?%;color:#ccc}\n/* 外层视图 */.messageList[data-v-85d0dbd4]{width:100%}.list[data-v-85d0dbd4]{position:relative;height:%?152?%;line-height:%?152?%;overflow:hidden;border-bottom:%?1?% solid #ebebeb}\n/* 删除外层包裹视图 */.list_del[data-v-85d0dbd4]{position:absolute;top:0}.list_del.txt[data-v-85d0dbd4]{position:relative;background-color:#fff;width:100%;z-index:5;padding:0 %?10?%;-webkit-transition:left .2s ease-in-out;-o-transition:left .2s ease-in-out;transition:left .2s ease-in-out;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}\n/* 删除 */.list_del.del[data-v-85d0dbd4]{background-color:#e64340;width:%?180?%;text-align:center;z-index:4;right:0;color:#fff}\n/* 列表图片 */.list_img[data-v-85d0dbd4]{width:%?105?%;height:%?105?%;border-radius:50%;vertical-align:middle;margin-left:%?15?%;margin-top:%?-8?%;display:inline-block}.list_del uni-text[data-v-85d0dbd4]{white-space:nowarp;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;max-width:%?420?%}\n/* 列表名称 */.list_name[data-v-85d0dbd4]{position:absolute;left:%?168?%;bottom:%?36?%}\n/* 活动时间 */.list_datas[data-v-85d0dbd4]{position:absolute;left:%?168?%;top:%?36?%;font-size:13px;color:#818181}\n/* 未读数量 */.list_number[data-v-85d0dbd4]{position:absolute;bottom:12px;right:25px;min-width:%?34?%;height:%?34?%;font-size:%?20?%;color:#fff;line-height:%?34?%;text-align:center;border-radius:50%;background-color:red}.list_time[data-v-85d0dbd4]{position:absolute;top:12px;right:25px;min-width:%?34?%;height:%?34?%;color:#999;font-size:%?24?%;line-height:%?34?%;text-align:center;background-color:#fff}body.?%PAGE?%[data-v-85d0dbd4]{background-color:#f5f5f5}",""])},"4fdf":function(n,t,e){"use strict";e.r(t);var i=e("63ff"),a=e.n(i);for(var o in i)"default"!==o&&function(n){e.d(t,n,function(){return i[n]})}(o);t["default"]=a.a},"60e5":function(n,t,e){"use strict";var i=e("b96c"),a=e.n(i);a.a},"63ff":function(n,t,e){"use strict";function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=getApp(),o=(e("ef31"),{data:function(){return{messageList:[""],isLoad:!0}},onLoad:function(n){var t=this;console.log("开始加载聊天消息"),a.initIM().then(function(){a.loginIM().then(function(){a.JIM.onSyncConversation(function(n){n.forEach(function(n,t){var e=n.msgs.splice(-1);a.JIM.updateConversation({username:n.from_username,extras:e[0].content.msg_body.extras})})}),t.getMessageList(),t.openMsgReceive()})})},onShow:function(){},onUnload:function(){this.globalData.JIM.loginOut()},onHide:function(){this.globalData.JIM.loginOut()},methods:{getData:function(){uni.showLoading({title:"加载中..."})},openMsgReceive:function(){var n=this;a.globalDataJIM.onMsgReceive(function(t){var e=!0;n.data.messageList.forEach(function(a,o){t.messages.forEach(function(t){a.username==t.from_username&&(e=!1,a.extras=t.content.msg_body.extras,n.JIM.updateConversation({username:a.username,extras:a.extras}),a.unread_msg_count++,n.setData(i({},"messageList["+o+"]",a)))}),e&&n.getMessageList()})})},resetUnreadCount:function(n){var t=n.currentTarget.dataset,e=t.username,o=t.nickname,s=this.data.messageList,d=this;s.forEach(function(n,t){n.username==e&&d.setData(i({},"messageList["+t+"].unread_msg_count",0))}),a.JIM.resetUnreadCount({username:e}),uni.navigateTo({url:"../IM/IM?username="+e+"&nickname="+o})},getMessageList:function(){var n=this;a.JIM.getConversation().onSuccess(function(t){var e=t.code,i=t.conversations,o=t.message;if(0==e){if(console.log(i),0==i.length)return;i.forEach(function(t,e){(new Date).getDate()==new Date(t.mtime).getDate()?t.mtime=new Date(t.mtime).Format("hh:mm"):t.mtime=new Date(t.mtime).Format("yyyy-MM-dd"),a.globalData.JIM.getResource({media_id:t.avatar}).onSuccess(function(a){var o=a.code,s=a.url,d=a.massage;o?uni.showToast({title:d,icon:"none"}):(t.avatar=s,i.length==e+1&&n.setData({messageList:i}))}).onFail(function(n){n.code;var t=n.massage;uni.showToast({title:t,icon:"none"})})})}else uni.showToast({title:o,icon:"none"})}).onFail(function(n){})}}});t.default=o},"7d38":function(n,t,e){"use strict";e.r(t);var i=e("fcd9"),a=e("4fdf");for(var o in a)"default"!==o&&function(n){e.d(t,n,function(){return a[n]})}(o);e("60e5");var s=e("2877"),d=Object(s["a"])(a["default"],i["a"],i["b"],!1,null,"85d0dbd4",null);t["default"]=d.exports},b96c:function(n,t,e){var i=e("1173");"string"===typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);var a=e("4f06").default;a("2be73002",i,!0,{sourceMap:!1,shadowMode:!1})},fcd9:function(n,t,e){"use strict";var i=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",{staticClass:"messageList"},[0==n.messageList.length?e("v-uni-view",{staticClass:"empty"},[e("v-uni-image",{staticClass:"image",attrs:{src:n.imgUrl+"/empty_fans.png"}}),e("v-uni-view",{staticClass:"describe"},[n._v("还没有人联系您哦~")])],1):n._e(),n._l(n.messageList,function(t,i){return e("v-uni-view",{key:i,staticClass:"list",attrs:{id:"height"}},[e("v-uni-view",{attrs:{"data-username":t.username,"data-nickname":t.nickName},on:{click:function(t){t=n.$handleEvent(t),n.resetUnreadCount(t)}}},[e("v-uni-view",{staticClass:"list_del txt"},[e("v-uni-image",{staticClass:"list_img",attrs:{src:t.avatar}}),t.unread_msg_count>0?e("v-uni-view",{staticClass:"list_number"},[n._v(n._s(t.unread_msg_count))]):n._e(),e("v-uni-text",{staticClass:"list_time"},[n._v(n._s(t.mtime))]),e("v-uni-text",{staticClass:"list_name"},[n._v(n._s(t.nickName))]),e("v-uni-text",{staticClass:"list_datas"},[n._v(n._s(t.extras.lastConversation))])],1)],1)],1)})],2)},a=[];e.d(t,"a",function(){return i}),e.d(t,"b",function(){return a})}}]);